(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(e){if(e.ep)return;e.ep=!0;const s=r(e);fetch(e.href,s)}})();let c=-1,d=[],g="";class a{constructor(t,r,i,e=!1){console.log(this),this.sqrt=i,this.w=t,this.h=r,this.type="wall",c++,e&&(c=-1),this.createDiv()}createDiv(){this.img=document.createElement("img"),this.img.setAttribute("src","gfx/heks.png"),this.img.style.width=`${this.w}px`,this.img.style.height=`${this.h}px`,this.img.style.position="relative",this.div=document.createElement("div"),this.div.append(this.img),this.div.id=c,this.div.style.width=`${this.w}px`,this.div.style.height=`${this.h}px`,this.div.style.position="absolute";let t=0;this.div.onclick=r=>{let i=r.currentTarget.id%this.sqrt,e=Math.floor(r.currentTarget.id/this.sqrt);console.log(this.type),t++;let s={id:r.currentTarget.id,x:i,y:e,dirOut:t%6,dirIn:(t+3)%6,type:this.type};this.img.setAttribute("src","gfx/"+t%6+".png"),this.img.style.transform=`rotate(${t%6*60}deg) `,d.filter(h=>h.id==r.currentTarget.id).length>0?d=d.map((h,y)=>d.length==1?{id:r.currentTarget.id,x:i,y:e,dirOut:t%6,dirIn:"pierwsze",type:this.type}:h.id==r.currentTarget.id?(console.log("aa"),{id:r.currentTarget.id,x:i,y:e,dirOut:t%6,dirIn:d[y-1].dirOut,type:this.type}):h):d.push(s);let o={size:this.sqrt,level:[...d]},p=document.querySelector(".jsonData");g=o,p.value=JSON.stringify(o,null,2)}}changeType(t){this.type=t}getRoot(){return this.div}async getSize(){let t=await fetch("http://localhost:3000/get",{method:"GET",headers:{"Content-Type":"application/json"}});return this.textarea=await t.json(),+this.textarea.size}async getJson(t,r){let i=await fetch("http://localhost:3000/get",{method:"GET",headers:{"Content-Type":"application/json"}});this.textarea=await i.json(),this.level=this.textarea.level,console.log(this.textarea.size),g=JSON.stringify(this.textarea),console.log(t),c=-1,t.innerHTML="";for(let e=0;e<this.textarea.size;e++)for(let s=0;s<this.textarea.size;s++){const o=new a(100,100,this.textarea.size);o.setXY(s*80,e*90+s%2*45),console.log(o),t.append(o.getRoot())}this.level.map(e=>{console.log(e),c=e.y*this.textarea.size+e.x,console.log(c),Array.from(t.children).forEach(s=>{s.id==c&&(s.firstChild.setAttribute("src","gfx/"+e.dirOut+".png"),s.firstChild.style.transform=`rotate(${e.dirOut*60}deg) `)})}),r.value=JSON.stringify(this.textarea,null,2)}async sendJson(){return await(await fetch("http://localhost:3000/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:g})})).json()}setXY(t,r){this.div.style.left=`${t+300}px`,this.div.style.top=`${r+10}px`}}const u=document.querySelector(".board"),n=document.querySelector(".size"),f=document.querySelector(".jsonData"),m=document.querySelector(".walls"),v=document.querySelector(".tresure"),w=document.querySelector(".light"),q=document.querySelector(".send"),x=document.querySelector(".get");window.addEventListener("load",()=>{u.innerHTML="",new a(100,100,Math.sqrt(+n.value),!0);for(let l=0;l<Math.sqrt(+n.value);l++)for(let t=0;t<Math.sqrt(+n.value);t++){const r=new a(100,100,Math.sqrt(+n.value));r.setXY(t*80,l*90+t%2*45),console.log(r),u.append(r.getRoot())}});n.addEventListener("input",()=>{u.innerHTML="",f.value="",new a(100,100,Math.sqrt(+n.value),!0);for(let l=0;l<Math.sqrt(+n.value);l++)for(let t=0;t<Math.sqrt(+n.value);t++){const r=new a(100,100,Math.sqrt(+n.value));m.addEventListener("click",()=>{r.changeType("wall")}),v.addEventListener("click",()=>{r.changeType("tresure")}),w.addEventListener("click",()=>{r.changeType("light")}),r.setXY(t*80,l*90+t%2*45),console.log(r),u.append(r.getRoot())}});q.addEventListener("click",()=>{new a().sendJson(document.querySelector(".board"))});x.addEventListener("click",()=>{new a().getJson(document.querySelector(".board"),document.querySelector(".jsonData"))});
