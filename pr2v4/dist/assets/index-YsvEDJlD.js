import"./modulepreload-polyfill-9p4a8sJU.js";let l=-1,c=[],g="";class n{constructor(t,e,a,s=!1){console.log(this),this.sqrt=a,this.w=t,this.h=e,this.type="wall",l++,s&&(l=-1),this.createDiv()}createDiv(){this.img=document.createElement("img"),this.img.setAttribute("src","gfx/heks.png"),this.img.style.width=`${this.w}px`,this.img.style.height=`${this.h}px`,this.img.style.position="relative",this.div=document.createElement("div"),this.div.append(this.img),this.div.id=l,this.div.style.width=`${this.w}px`,this.div.style.height=`${this.h}px`,this.div.style.position="absolute";let t=0;this.div.onclick=e=>{let a=e.currentTarget.id%this.sqrt,s=Math.floor(e.currentTarget.id/this.sqrt);console.log(this.type),t++;let i={id:e.currentTarget.id,x:a,y:s,dirOut:t%6,dirIn:(t+3)%6,type:this.type};this.img.setAttribute("src","gfx/"+t%6+".png"),this.img.style.transform=`rotate(${t%6*60}deg) `,c.filter(d=>d.id==e.currentTarget.id).length>0?c=c.map((d,y)=>c.length==1?{id:e.currentTarget.id,x:a,y:s,dirOut:t%6,dirIn:"pierwsze",type:this.type}:d.id==e.currentTarget.id?(console.log("aa"),{id:e.currentTarget.id,x:a,y:s,dirOut:t%6,dirIn:c[y-1].dirOut,type:this.type}):d):c.push(i);let h={size:this.sqrt,level:[...c]},p=document.querySelector(".jsonData");g=h,p.value=JSON.stringify(h,null,2)}}changeType(t){this.type=t}getRoot(){return this.div}async getSize(){let t=await fetch("http://localhost:3000/get",{method:"GET",headers:{"Content-Type":"application/json"}});return this.textarea=await t.json(),+this.textarea.size}async getJson(t,e){let a=await fetch("http://localhost:3000/get",{method:"GET",headers:{"Content-Type":"application/json"}});this.textarea=await a.json(),this.level=this.textarea.level,console.log(this.textarea.size),g=JSON.stringify(this.textarea),console.log(t),l=-1,t.innerHTML="";for(let s=0;s<this.textarea.size;s++)for(let i=0;i<this.textarea.size;i++){const h=new n(100,100,this.textarea.size);h.setXY(i*80,s*90+i%2*45),console.log(h),t.append(h.getRoot())}this.level.map(s=>{console.log(s),l=s.y*this.textarea.size+s.x,console.log(l),Array.from(t.children).forEach(i=>{i.id==l&&(i.firstChild.setAttribute("src","gfx/"+s.dirOut+".png"),i.firstChild.style.transform=`rotate(${s.dirOut*60}deg) `)})}),e.value=JSON.stringify(this.textarea,null,2)}async sendJson(){return await(await fetch("http://localhost:3000/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:g})})).json()}setXY(t,e){this.div.style.left=`${t+300}px`,this.div.style.top=`${e+10}px`}}const u=document.querySelector(".board"),r=document.querySelector(".size"),v=document.querySelector(".jsonData"),m=document.querySelector(".walls"),f=document.querySelector(".tresure"),w=document.querySelector(".light"),x=document.querySelector(".send"),q=document.querySelector(".get");window.addEventListener("load",()=>{u.innerHTML="",new n(100,100,Math.sqrt(+r.value),!0);for(let o=0;o<Math.sqrt(+r.value);o++)for(let t=0;t<Math.sqrt(+r.value);t++){const e=new n(100,100,Math.sqrt(+r.value));e.setXY(t*80,o*90+t%2*45),console.log(e),u.append(e.getRoot())}});r.addEventListener("input",()=>{u.innerHTML="",v.value="",new n(100,100,Math.sqrt(+r.value),!0);for(let o=0;o<Math.sqrt(+r.value);o++)for(let t=0;t<Math.sqrt(+r.value);t++){const e=new n(100,100,Math.sqrt(+r.value));m.addEventListener("click",()=>{e.changeType("wall")}),f.addEventListener("click",()=>{e.changeType("tresure")}),w.addEventListener("click",()=>{e.changeType("light")}),e.setXY(t*80,o*90+t%2*45),console.log(e),u.append(e.getRoot())}});x.addEventListener("click",()=>{new n().sendJson(document.querySelector(".board"))});q.addEventListener("click",()=>{new n().getJson(document.querySelector(".board"),document.querySelector(".jsonData"))});
